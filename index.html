<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Read an earn Bot</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://sad.adsgram.ai/js/sad.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:"Roboto",sans-serif;}
body{background:#000;color:white;padding:20px;padding-top:120px;display:none;}
.header{position:fixed;top:0;width:100%;background:#000;display:flex;justify-content:space-between;align-items:center;padding:15px 20px;z-index:100;}
.header h1{font-size:24px;}
.button-container{display:flex;flex-wrap:wrap;gap:10px;margin-bottom:20px;}
.btn{flex:1;padding:10px;border:none;border-radius:8px;cursor:pointer;font-weight:700;}
.read-btn{background:#007bff;color:white;}
.task-btn{background:#ffc107;color:black;}
.watch-btn{background:#28a745;color:white;}
.withdraw-btn{background:#6f42c1;color:white;}
.referral-btn{background:#fd7e14;color:black;}
.article-container{background:#222;padding:12px;border-radius:12px;overflow-y:auto;max-height:60vh;}
#commentSection{margin-top:15px;}
#commentBox, #submitComment{display:block;margin-top:10px;padding:8px;border-radius:6px;border:1px solid #555;background:#111;color:white;width:100%;}
.popup{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#111;padding:20px;border-radius:12px;z-index:200;max-width:400px;width:90%;}
.toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:#28a745;color:white;padding:10px 20px;border-radius:8px;opacity:0;transition:opacity 0.5s ease-in-out;z-index:200;}
.toast.show{opacity:1;}
</style>
</head>
<body>

<div class="header">
<h1>EarnZone Bot</h1>
<div id="pointsDisplay">Balance: 0 pts</div>
</div>

<div class="button-container">
<button class="btn read-btn" onclick="openArticle()">Read & Earn</button>
<button class="btn task-btn" onclick="showTaskAd()">Task & Earn</button>
<button class="btn watch-btn" onclick="showWatchAd()">Watch Videos</button>
<button class="btn withdraw-btn" onclick="openWithdraw()">Withdraw</button>
<button class="btn referral-btn" onclick="copyReferral()">Referral</button>
</div>

<div class="article-container" id="articleContainer"></div>

<div id="commentSection" style="display:none;">
<textarea id="commentBox" placeholder="Write a comment..."></textarea>
<button id="submitComment" class="btn read-btn" onclick="submitComment()">Submit Comment</button>
</div>

<!-- Withdraw Popup -->
<div class="popup" id="withdrawPopup" style="display:none;">
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;"><h2>Withdraw Balance</h2><span onclick="closeWithdraw()" style="cursor:pointer">X</span></div>
<p>Your balance: <span id="withdrawPoints">0</span> pts</p>
<select id="withdrawMethod" style="margin-bottom:10px;width:100%;padding:8px;border-radius:6px;background:#111;color:white;border:1px solid #555;">
<option value="payeer">Payeer</option>
<option value="skrill">Skrill</option>
<option value="wire">Wire Transfer</option>
<option value="usdt">USDT TRC20</option>
</select>
<input id="withdrawDetails" placeholder="Account / Wallet details" style="margin-bottom:10px;width:100%;padding:8px;border-radius:6px;background:#111;color:white;border:1px solid #555;">
<button class="btn withdraw-btn" onclick="submitWithdraw()">Send Withdraw Request</button>
</div>

<div class="toast" id="toast"></div>

<script>
const tg = window.Telegram.WebApp ?? { sendData: () => {}, expand: () => {} };
tg.expand();

const BOT_TOKEN = "8323079060:AAEwv9UUfi-MgBiiXk9RNdo9-Xl0mcLfZ5k";
const CHANNEL = "@Konnetearnchannel";

// -------------------- BALANCE SYSTEM --------------------
let storedBalance = parseInt(localStorage.getItem('userBalance'));
let userBalance = isNaN(storedBalance) ? 0 : storedBalance;
updateBalance();

function updateBalance(){ document.getElementById('pointsDisplay').innerText = `Balance: ${userBalance} pts`; }
function saveBalance(){ localStorage.setItem('userBalance', userBalance); updateBalance(); }
function showToast(msg){ const t=document.getElementById('toast'); t.innerText=msg; t.classList.add('show'); }

// -------------------- FORCE JOIN & REWARD --------------------
function checkJoin() {
  let tgUser = tg.initDataUnsafe?.user;

  if (!tgUser) {
    document.body.innerHTML = "<h2 style='color:white;text-align:center;margin-top:50px;'>‚ùå Open bot inside Telegram.</h2>";
    return;
  }

  fetch(`https://api.telegram.org/bot${BOT_TOKEN}/getChatMember?chat_id=${CHANNEL}&user_id=${tgUser.id}`)
    .then(r => r.json())
    .then(data => {
      const status = data?.result?.status;

      if (status === "member" || status === "administrator" || status === "creator") {

        // ‚≠ê GIVE 100 POINTS AFTER JOIN (only once)
        if (!localStorage.getItem("joinedRewardGiven")) {
            userBalance += 100;
            saveBalance();
            localStorage.setItem("joinedRewardGiven", "yes");
            showToast("üéâ Thanks for joining! +100 pts");
        }

        // Show menu
        document.body.style.display = "block";

      } else {
        document.body.innerHTML = `
          <div style='text-align:center;margin-top:100px;color:white;'>
            <h2>üö´ You must join our channel first</h2>
            <a href='https://t.me/Konnetearnchannel' target='_blank'
               style='display:inline-block;margin-top:20px;background:#007bff;padding:12px 20px;border-radius:10px;color:white;font-weight:700;text-decoration:none;'>
               üëâ Join Channel
            </a>
            <br><br>
            <button onclick='location.reload()'
              style='background:#28a745;color:white;padding:10px 20px;border-radius:8px;font-size:16px;border:none;margin-top:20px;'>
              ‚úî I Joined ‚Äì Continue
            </button>
          </div>
        `;
      }
    });
}

// -------------------- ADSGRAM PRELOAD --------------------
const rewardAd = window.Adsgram.init({ blockId: "18943" });
rewardAd.show().then(res => {
  if(res.done){ userBalance += 100; saveBalance(); }
  checkJoin();
}).catch(err=>{
  console.log(err);
  checkJoin();
});

// -------------------- READ ARTICLE --------------------
function openArticle(){
  const articleText = `
<h2>Top 5 Ways to Make Money Online in 2025</h2>
<p>2025 offers huge opportunities for digital income. Freelancing, AI content creation, affiliate marketing, online courses, and smart crypto investing are among the best ways to earn.</p>
<ol>
<li><b>Freelancing:</b> Offer skills on Fiverr, Upwork, etc.</li>
<li><b>AI Content:</b> Use ChatGPT to create content for businesses.</li>
<li><b>Affiliate Marketing:</b> Promote products and earn commissions.</li>
<li><b>Online Courses & Ebooks:</b> Teach skills and sell online.</li>
<li><b>Crypto & NFT:</b> Staking, NFTs, and P2E gaming for high returns.</li>
</ol>`;
  document.getElementById('articleContainer').innerHTML = articleText;
  document.getElementById('commentSection').style.display='block';
}

// -------------------- COMMENT SYSTEM --------------------
function submitComment(){
  const commentText = document.getElementById("commentBox").value.trim();
  if(!commentText){ showToast("‚ùå Write a comment first!"); return; }
  if(userBalance < 6000){ showToast("‚ùå You don't have 6,000 points to comment!"); showClaimTask(); return; }

  userBalance -= 6000;
  saveBalance();
  showToast("‚úÖ Comment submitted successfully!");

  document.getElementById("commentBox").remove();
  document.getElementById("submitComment").remove();

  const now = new Date();
  const dateStr = now.toLocaleDateString();
  const timeStr = now.toLocaleTimeString();

  const newComment = document.createElement("div");
  newComment.style.marginTop = "15px";
  newComment.style.padding = "10px";
  newComment.style.background = "#111";
  newComment.style.borderRadius = "8px";
  newComment.innerHTML = `<p>${commentText}</p><small style="color:#aaa;">Posted on ${dateStr} at ${timeStr}</small>`;
  document.getElementById("commentSection").appendChild(newComment);

  setTimeout(() => { document.getElementById("toast").classList.remove("show"); }, 30000);
}

// -------------------- TASK ADS --------------------
const taskBlocks = ["task-18944","task-18945","task-18946","task-18947","task-18948"];
let currentTaskIndex = 0;

function showTaskAd(){
  const blockId = taskBlocks[currentTaskIndex];
  const taskContainer = document.createElement('div');
  taskContainer.innerHTML = `<adsgram-task data-block-id="${blockId}" class="task"></adsgram-task>`;
  document.body.appendChild(taskContainer);
  const taskEl = taskContainer.querySelector('adsgram-task');
  taskEl.addEventListener('reward', () => {
    userBalance += 100;
    saveBalance();
    showToast("‚úÖ Task completed! +100 pts");
    currentTaskIndex = (currentTaskIndex + 1) % taskBlocks.length;
    taskContainer.remove();
  }, {once:true});
}

function showClaimTask(){
  const blockId = taskBlocks[currentTaskIndex];
  const claimContainer = document.createElement('div');
  claimContainer.innerHTML = `<adsgram-task data-block-id="${blockId}" class="task"></adsgram-task>`;
  document.body.appendChild(claimContainer);
  const taskEl = claimContainer.querySelector('adsgram-task');
  taskEl.addEventListener('reward', () => {
    userBalance += 100;
    saveBalance();
    showToast("‚úÖ Points claimed! You can now comment.");
    currentTaskIndex = (currentTaskIndex + 1) % taskBlocks.length;
    claimContainer.remove();
  }, {once:true});
}

// -------------------- WATCH ADS --------------------
function showWatchAd(){
  rewardAd.show().then(res => {
    if(res.done){ userBalance += 100; saveBalance(); showToast("‚úÖ Video watched! +100 pts"); }
  }).catch(console.log);
}

// -------------------- REFERRAL --------------------
function copyReferral(){
  const ref = "https://t.me/Earnzonesbot?start=konnet" + Math.floor(Math.random()*99999);
  navigator.clipboard.writeText(ref);
  showToast("Referral link copied!");
}

// -------------------- WITHDRAW --------------------
const MIN_WITHDRAW = 50000;

function openWithdraw(){
  if(userBalance < MIN_WITHDRAW){ showToast("‚ùå Minimum 50,000 pts required."); return; }
  document.getElementById('withdrawPopup').style.display='block';
  document.getElementById('withdrawPoints').innerText=userBalance;
}

function closeWithdraw(){ document.getElementById('withdrawPopup').style.display='none'; }

function submitWithdraw(){
  if(userBalance < MIN_WITHDRAW){ showToast("‚ùå Minimum 50,000 pts required."); return; }
  const method = document.getElementById('withdrawMethod').value;
  const details = document.getElementById('withdrawDetails').value.trim();
  if(!details){ showToast("‚ùå Enter account/wallet details."); return; }

  tg.sendData(JSON.stringify({action:"withdraw", amount:MIN_WITHDRAW, method, details}));
  showToast(`‚úÖ Withdraw request of 50,000 pts sent via ${method}`);

  userBalance -= MIN_WITHDRAW;
  saveBalance();
  closeWithdraw();
}
</script>
</body>
</html>

