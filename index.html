<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Juggearn Bot</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" crossorigin="anonymous" />

<!-- ✅ AdExtra SDK -->
<script async src="https://partner.adextra.io/jt/1373dc805a4dcd7bef68f6e8f334c7a47368b5e6.js"></script>

<style>
@import url("https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap");
* {margin:0; padding:0; box-sizing:border-box; font-family:"Roboto",sans-serif;}
body {background:#000; color:white; padding:20px; padding-top:100px;}
.header {position:fixed; top:0; width:100%; background:#000; display:flex; justify-content:space-between; align-items:center; padding:15px 20px; z-index:100;}
.header h1 {font-size:24px;}
.article-container {margin-top:100px; display:grid; grid-template-columns:repeat(auto-fill,minmax(180px,1fr)); gap:12px;}
.article {background:#222; border-radius:12px; padding:12px; cursor:pointer; transition:transform 0.2s;}
.article:hover {transform:scale(1.05);}
.article h3 {font-size:16px; font-weight:700; margin-bottom:6px;}
.article p {font-size:12px; color:#bbb; overflow:hidden; display:-webkit-box; -webkit-line-clamp:3; -webkit-box-orient:vertical;}
.fab, .fab-withdraw, .fab-watch, .fab-task, .fab-referral {position:fixed; width:56px; height:56px; border-radius:50%; display:flex; justify-content:center; align-items:center; font-size:22px; cursor:pointer;}
.fab {bottom:40px; right:20px; background:#ffc107; color:black;}
.fab-withdraw {bottom:110px; right:20px; background:#28a745; color:white;}
.fab-watch {bottom:180px; right:20px; background:#007bff; color:white;}
.fab-task {bottom:250px; right:20px; background:#6f42c1; color:white;}
.fab-referral {bottom:320px; right:20px; background:#17a2b8; color:white;}
.popup, .withdraw-popup {position:fixed; top:0; left:0; width:100vw; height:100vh; background:#000; display:none; flex-direction:column; padding:20px; padding-top:100px; overflow-y:auto;}
.popup input, .popup textarea, .withdraw-popup select, .withdraw-popup input {width:100%; background:none; border:1px solid #555; color:white; margin-bottom:10px; padding:8px; border-radius:6px;}
.popup textarea {height:50vh; resize:none;}
.popup-header, .withdraw-header {display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;}
.btn {padding:10px; border:none; border-radius:5px; cursor:pointer; margin-top:10px;}
.save-btn {background:#28a745; color:white;}
.read-btn {background:#007bff; color:white; margin-top:8px; width:100%; border-radius:6px; padding:6px;}
.points {margin-top:5px; font-size:14px; color:gray; cursor:pointer;}
.comment-btn {margin-top:10px; background:#17a2b8; color:white; border:none; padding:8px; border-radius:6px; width:100%;}
/* Toast */
.toast {position:fixed; bottom:20px; left:50%; transform:translateX(-50%); background:#28a745; color:white; padding:10px 20px; border-radius:8px; opacity:0; transition:opacity 0.5s ease-in-out; z-index:200;}
.toast.show {opacity:1;}
</style>

<script src="https://telegram.org/js/telegram-web-app.js?1"></script>

<script>
const ADMIN_CHAT_ID = "6136849497"; 
const MIN_WITHDRAW = 15000; // points
const REWARD_PER_AD = 100; // points per ad
const REFERRAL_BONUS = 20;
const REFERRAL_COMMISSION = 0.05;

window.Telegram.WebApp.ready();
const webApp = Telegram.WebApp;
const currentUserId = webApp.initDataUnsafe.user?.id || 'guest';
const currentUsername = webApp.initDataUnsafe.user?.username || 'unknown';

function isAdmin() { return String(currentUserId) === ADMIN_CHAT_ID; }

function saveUserBalance(balance){
  let allBalances = JSON.parse(localStorage.getItem('userBalance')||'{}');
  allBalances[currentUserId] = balance;
  localStorage.setItem('userBalance', JSON.stringify(allBalances));
}
function getUserBalance(){
  let allBalances = JSON.parse(localStorage.getItem('userBalance')||'{}');
  return allBalances[currentUserId] || 0;
}

// Referral tracking
function getReferralCode(){ return currentUserId; }
function getReferralBalance(referrerId, earnedPoints){
  if(!referrerId || referrerId===currentUserId) return;
  let allRefBalances = JSON.parse(localStorage.getItem('refBalance')||'{}');
  let bonus = Math.floor(earnedPoints * REFERRAL_COMMISSION);
  allRefBalances[referrerId] = (allRefBalances[referrerId]||0) + bonus;
  localStorage.setItem('refBalance', JSON.stringify(allRefBalances));
}

// AdExtra ad display
function showAdExtra(callback){
  const adDiv = document.createElement('div');
  adDiv.id = 'adextraBlock';
  document.body.prepend(adDiv);
  const script = document.createElement('script');
  script.src = "https://partner.adextra.io/jt/1373dc805a4dcd7bef68f6e8f334c7a47368b5e6.js";
  script.async = true;
  script.onload = () => { if(callback) callback(); };
  document.body.appendChild(script);
}

// Toast
function showToast(msg){
  let toast=document.getElementById('toast');
  toast.innerText=msg;
  toast.classList.add('show');
  setTimeout(()=>toast.classList.remove('show'),2000);
}

// Article functions
let articlesCache = [
  {
    title:"How to Make Money Online 2025",
    content:`Welcome to 2025! In this guide, we'll explore actionable ways to make money online using the latest trends. First, freelancing has become increasingly lucrative with platforms connecting talent worldwide. Second, affiliate marketing is booming: promoting products via social media or blogs can generate passive income. Third, digital content creation—YouTube, TikTok, and streaming—remains a strong source. Fourth, investing in cryptocurrencies and NFTs, while risky, can yield high returns if researched carefully. Fifth, online courses and coaching provide another avenue. The key is consistency, engagement, and learning new tools and trends. Every action you take online can accumulate points, rewards, and real money when leveraged correctly. Remember, reading these insights fully gives you valuable points!`
  }
];

function openArticle(index){
  showAdExtra(() => {
    const art = articlesCache[index];
    const popup = document.getElementById('articlePopup');
    popup.style.display='flex';
    document.getElementById('articleTitle').innerText = art.title;
    document.getElementById('articleContent').innerText = art.content;
    // reward user
    let balance = getUserBalance() + REWARD_PER_AD;
    saveUserBalance(balance);
    showToast(`+${REWARD_PER_AD} points`);
  });
}

function closeArticle(){ document.getElementById('articlePopup').style.display='none'; }

// Comment functionality
function openComment(){
  let balance = getUserBalance();
  if(balance < 1500){
    alert("You need 1500 points to comment. Earn more first!");
    return;
  }
  let comment = prompt("Enter your comment:");
  if(comment){
    let allComments = JSON.parse(localStorage.getItem('comments')||'[]');
    allComments.push({user: currentUsername, comment});
    localStorage.setItem('comments', JSON.stringify(allComments));
    showToast("Comment submitted!");
  }
}

// Task/Watch videos earn
function showTaskAd(){
  showAdExtra(() => {
    let balance = getUserBalance() + REWARD_PER_AD;
    saveUserBalance(balance);
    showToast(`+${REWARD_PER_AD} points (Task)`);
  });
}

// Withdraw
function openWithdraw(){
  document.getElementById('withdrawPopup').style.display='flex';
  document.getElementById('withdrawPoints').innerText=getUserBalance();
}
function closeWithdraw(){ document.getElementById('withdrawPopup').style.display='none'; }
function submitWithdraw(){
  let balance=getUserBalance();
  let method=document.getElementById('withdrawMethod').value;
  if(balance<MIN_WITHDRAW){ alert(`Minimum withdrawal is ${MIN_WITHDRAW} points`); return; }
  saveUserBalance(balance - MIN_WITHDRAW);
  alert(`Withdrawal request of ${MIN_WITHDRAW} points via ${method} sent to admin.`);
  closeWithdraw();
}

// Referral
function showReferral(){
  let link = `https://t.me/Juggearn_bot?start=${getReferralCode()}`;
  prompt("Share this link with friends to earn points:", link);
}

// Render articles
function renderArticles(){
  const container=document.getElementById('articlesContainer');
  container.innerHTML='';
  articlesCache.forEach((art,index)=>{
    let div=document.createElement('div');
    div.className='article';
    div.innerHTML=`<h3>${art.title}</h3><p>${art.content}</p><button class="comment-btn" onclick="openComment()">Comment</button>`;
    div.onclick=()=>openArticle(index);
    container.appendChild(div);
  });
  document.getElementById('pointsDisplay').innerText=`Balance: ${getUserBalance()} points`;
}

document.addEventListener('DOMContentLoaded', () => {
  if(!webApp.initDataUnsafe) alert("Please open this inside Telegram.");
  renderArticles();
});
</script>
</head>
<body>

<div class="header">
  <h1>Juggearn Bot</h1>
  <div class="points" id="pointsDisplay" onclick="openWithdraw()">Balance: 0 points <i class="fa fa-wallet"></i></div>
</div>

<div class="article-container" id="articlesContainer"></div>

<div class="fab-watch" onclick="showTaskAd()"><i class="fa fa-play"></i></div>
<div class="fab-withdraw" onclick="openWithdraw()"><i class="fa fa-wallet"></i></div>
<div class="fab-referral" onclick="showReferral()"><i class="fa fa-user-friends"></i></div>

<!-- Article Popup -->
<div class="popup" id="articlePopup">
  <div class="popup-header"><h2 id="articleTitle">Title</h2><span onclick="closeArticle()" style="cursor:pointer">X</span></div>
  <p id="articleContent">Content</p>
</div>

<!-- Withdraw Popup -->
<div class="withdraw-popup" id="withdrawPopup">
  <div class="withdraw-header"><h2>Withdraw Points</h2><span onclick="closeWithdraw()" style="cursor:pointer">X</span></div>
  <p>Your balance: <span id="withdrawPoints">0</span></p>
  <select id="withdrawMethod">
    <option value="payeer">Payeer</option>
    <option value="skrill">Skrill</option>
    <option value="wire">Wire Transfer</option>
    <option value="usdt">USDT TRC20</option>
  </select>
  <button class="btn save-btn" onclick="submitWithdraw()">Withdraw</button>
</div>

<div class="toast" id="toast"></div>

</body>
</html>
